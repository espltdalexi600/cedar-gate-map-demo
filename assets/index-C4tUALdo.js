(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))o(i);new MutationObserver(i=>{for(const n of i)if(n.type==="childList")for(const r of n.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&o(r)}).observe(document,{childList:!0,subtree:!0});function e(i){const n={};return i.integrity&&(n.integrity=i.integrity),i.referrerPolicy&&(n.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?n.credentials="include":i.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function o(i){if(i.ep)return;i.ep=!0;const n=e(i);fetch(i.href,n)}})();AFRAME.registerShader("gradientshader",{schema:{topColor:{type:"color",default:"1 0 0",is:"uniform"},bottomColor:{type:"color",default:"0 0 1",is:"uniform"}},vertexShader:["varying vec3 vWorldPosition;","void main() {"," vec4 worldPosition = modelMatrix * vec4( position, 1.0 );"," vWorldPosition = worldPosition.xyz;"," gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0 );","}"].join(`
`),fragmentShader:["#include <common>","#include <dithering_pars_fragment>","uniform vec3 bottomColor;","uniform vec3 topColor;","uniform float offset;","varying vec3 vWorldPosition;","void main() {"," float h = normalize( vWorldPosition ).y;"," gl_FragColor = vec4( mix( bottomColor, topColor, max( pow( max(h, 0.0 ), 0.8 ), 0.0 ) ), 1.0 );"," #include <dithering_fragment>","}"].join(`
`)});AFRAME.registerComponent("move-pin",{schema:{targetId:{default:""}},init(){const{targetId:s}=this.data;if(this.targetEl=document.getElementById(s),!this.targetEl)throw new Error(`[move-pin] Couldn't find el with id '${s}'`);this.canvasEl=this.el.sceneEl.renderer.domElement,this.camera=this.el.sceneEl.camera,this.worldPosition=new THREE.Vector3},tick(){this.el.object3D.getWorldPosition(this.worldPosition);const s=this.worldPosition.clone().project(this.camera),t=(s.x+1)/2*this.canvasEl.clientWidth,e=(-s.y+1)/2*this.canvasEl.clientHeight;this.targetEl.style.transform=`translate(${t}px, ${e}px)`}});AFRAME.registerComponent("move-to-target",{schema:{targetId:{default:""},debug:{default:!1},target:{default:{x:0,y:0,z:0}},initialPosition:{default:{x:0,y:0,z:0}}},init(){const{targetId:s}=this.data;if(this.targetEl=document.getElementById(s),!this.targetEl)throw new Error(`[move-to-target] Couldn't find el with id '${s}'`);this.scene=this.el.sceneEl.object3D,this.camera=this.el.getObject3D("camera"),this.targetPosition=new THREE.Vector3,this.targetEl.object3D.getWorldPosition(this.targetPosition);const t=this.buildCurve(this.camera.position,this.targetPosition,1,3);this.el.pause(),this.moveCamera({path:t,target:this.targetPosition})},remove(){this.moveCameraToDefault()},buildCurve(s,t,e=0,o=0){const{debug:i}=this.data,n=new THREE.Vector3(s.x,s.y,s.z),r=this.getControlPoint(s,t,.5),a=new THREE.Vector3(t.x,t.y+e,t.z),c=new THREE.Vector2(s.x-a.x,s.z-a.z);c.divideScalar(c.length()),a.set(a.x+c.x*o,a.y,a.z+c.y*o);const m=new THREE.QuadraticBezierCurve3(n,r,a);if(i){const l=m.getPoints(30),d=new THREE.BufferGeometry().setFromPoints(l),h=new THREE.Line(d,new THREE.LineBasicMaterial({color:16711680,transparent:!0,opacity:1}));h.name="debug_line",this.scene.add(h)}return m},moveCamera({path:s,target:t,onComplete:e}){const o=this,i=s.getLength(),n={value:0},r=new THREE.Quaternion().copy(o.camera.quaternion),a=s.getPointAt(1),c=new THREE.Matrix4;c.lookAt(a,t,new THREE.Vector3(0,1,0));const m=new THREE.Quaternion().setFromRotationMatrix(c);this.tween&&this.tween.kill(),this.tween=gsap.to(n,{duration:i/4,value:1,ease:Power1.easeInOut,onUpdate:function(l){const d=s.getPointAt(n.value);l.position.copy(d),l.lookAt(t);const h=new THREE.Quaternion().copy(l.quaternion),E=new THREE.Quaternion().copy(m);E.slerp(h,n.value*n.value*n.value),l.quaternion.slerpQuaternions(r,E,n.value)},onUpdateParams:[o.camera],onComplete:e})},moveCameraToDefault(){const{target:s,initialPosition:t}=this.data,e=this.buildCurve(this.camera.position,t);this.moveCamera({path:e,target:new THREE.Vector3(s.x,s.y,s.z),onComplete:()=>{this.el.play()}})},shortestAngle(s,t){return Math.atan2(Math.sin(t-s),Math.cos(t-s))},getControlPoint(s,t,e){const o=new THREE.Spherical().setFromVector3(s),i=new THREE.Spherical().setFromVector3(t),n=(o.radius+i.radius)/2,r=o.phi+this.shortestAngle(i.phi,o.phi)/2,a=(o.theta+i.theta)/2,c=new THREE.Spherical(n,r,a);return c.radius*=e,new THREE.Vector3().setFromSpherical(c)}});const b="modulepreload",v=function(s,t){return new URL(s,t).href},_={},y=function(t,e,o){let i=Promise.resolve();if(e&&e.length>0){let m=function(l){return Promise.all(l.map(d=>Promise.resolve(d).then(h=>({status:"fulfilled",value:h}),h=>({status:"rejected",reason:h}))))};const r=document.getElementsByTagName("link"),a=document.querySelector("meta[property=csp-nonce]"),c=a?.nonce||a?.getAttribute("nonce");i=m(e.map(l=>{if(l=v(l,o),l in _)return;_[l]=!0;const d=l.endsWith(".css"),h=d?'[rel="stylesheet"]':"";if(!!o)for(let u=r.length-1;u>=0;u--){const g=r[u];if(g.href===l&&(!d||g.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${l}"]${h}`))return;const p=document.createElement("link");if(p.rel=d?"stylesheet":b,d||(p.as="script"),p.crossOrigin="",p.href=l,c&&p.setAttribute("nonce",c),document.head.appendChild(p),d)return new Promise((u,g)=>{p.addEventListener("load",u),p.addEventListener("error",()=>g(new Error(`Unable to preload CSS for ${l}`)))})}))}function n(r){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=r,window.dispatchEvent(a),!a.defaultPrevented)throw r}return i.then(r=>{for(const a of r||[])a.status==="rejected"&&n(a.reason);return t().catch(n)})};class f{static async loadTweakpane(){const{Pane:t}=await y(async()=>{const{Pane:e}=await import("https://unpkg.com/tweakpane@4.0.5/dist/tweakpane.min.js");return{Pane:e}},[],import.meta.url);return t}static waitForComponentInit(t,e,o){t&&(t.components[e]?o():t.addEventListener("componentinitialized",({detail:i})=>{i.name===e&&o()}))}_options={sceneEl:document.getElementById("scene"),cameraEl:document.getElementById("camera"),mapPivotEl:document.getElementById("map-pivot"),mapEl:document.getElementById("map"),pinAnchorEls:document.querySelectorAll("[id^=pin-anchor]"),pinEls:document.querySelectorAll("[id^=pin]"),hemisphereLightEl:document.getElementById("hemisphere-light"),directionalLightEl:document.getElementById("directional-light"),skyEl:document.getElementById("sky"),cameraLookAt:{x:0,y:0,z:0},areaLabels:[],debug:!1};_defaultCameraPosition=new THREE.Vector3;_areas=[];_tweens={};constructor(t={}){Object.assign(this._options,t),this._onSceneLoaded=this._onSceneLoaded.bind(this),this._onMapModelLoaded=this._onMapModelLoaded.bind(this),this._init()}_rotateCameraToDefault(){const t=this._options.cameraEl.getObject3D("camera");if(t){const e=this._options.cameraLookAt;t.lookAt(e.x,e.y,e.z)}}_setCameraFolder(){if(this._options.cameraEl){const t=this._options.cameraEl.getAttribute("camera"),e=this._debugPanel.addFolder({title:"Camera",expanded:!1});e.addBinding(this._options.cameraEl.getObject3D("camera"),"position").on("change",({value:o})=>{this._rotateCameraToDefault()}),e.addBinding(this._options,"cameraLookAt").on("change",({value:o})=>{this._options.cameraLookAt=o,this._rotateCameraToDefault()}),e.addBinding(t,"fov").on("change",({value:o})=>{this._options.cameraEl.setAttribute("camera",{...this._options.cameraEl.getAttribute("camera"),fov:o})})}}_setMapFolder(){if(this._options.mapPivotEl&&this._options.mapEl){const t={position:this._options.mapEl.getAttribute("position"),scale:this._options.mapEl.getAttribute("scale")},e={rotation:this._options.mapPivotEl.getAttribute("rotation")},o=this._debugPanel.addFolder({title:"Map",expanded:!1});o.addBinding(e,"rotation").on("change",({value:i})=>{this._options.mapPivotEl.setAttribute("rotation",i)}),Object.keys(t).forEach(i=>{o.addBinding(t,i).on("change",({value:n})=>{this._options.mapEl.setAttribute(i,n)})})}}_setPinAnchorsFolder(){if(this._options.pinAnchorEls.length){const t={showPinAnchors:!1},e=this._debugPanel.addFolder({title:"Pin Anchors",expanded:!1});e.addBinding(t,"showPinAnchors").on("change",({value:o})=>{this._options.pinAnchorEls.forEach(i=>{i.setAttribute("visible",o)})}),this._options.pinAnchorEls.forEach(o=>{const i={position:o.getAttribute("position")};e.addBinding(i,"position",{step:.01}).on("change",({value:n})=>{o.setAttribute("position",n)})})}}_setHemisphereLightFolder(){if(this._options.hemisphereLightEl){const t={position:this._options.hemisphereLightEl.getAttribute("position")},e=this._options.hemisphereLightEl.getAttribute("light"),o=this._debugPanel.addFolder({title:"Hemisphere Light",expanded:!1});o.addBinding(t,"position",{step:.1}).on("change",({value:i})=>{this._options.hemisphereLightEl.setAttribute("position",i)}),[{object:e,key:"intensity",params:{step:.1}},{object:e,key:"color"}].forEach(({object:i,key:n,params:r})=>{o.addBinding(i,n,r).on("change",({value:a})=>{this._options.hemisphereLightEl.setAttribute("light",{...this._options.hemisphereLightEl.getAttribute("light"),[n]:a})})})}}_setDirectionalLightFolder(){if(this._options.directionalLightEl){const t={position:this._options.directionalLightEl.getAttribute("position")},e=this._options.directionalLightEl.getAttribute("light"),o=this._debugPanel.addFolder({title:"Directional Light",expanded:!1});o.addBinding(t,"position",{step:.1}).on("change",({value:i})=>{this._options.directionalLightEl.setAttribute("position",i)}),[{object:e,key:"intensity",params:{step:.1}},{object:e,key:"color"},{object:e,key:"castShadow"},{object:e,key:"shadowRadius"},{object:e,key:"shadowBias",params:{step:1e-5}}].forEach(({object:i,key:n,params:r})=>{o.addBinding(i,n,r).on("change",({value:a})=>{this._options.directionalLightEl.setAttribute("light",{...this._options.directionalLightEl.getAttribute("light"),[n]:a})})}),o.addBinding(this._options.directionalLightEl.getObject3D("light").shadow,"normalBias",{step:.001})}}_setSkyFolder(){if(this._options.skyEl){const t=this._options.skyEl.getAttribute("material"),e=this._debugPanel.addFolder({title:"Sky",expanded:!1});[{object:t,key:"topColor"},{object:t,key:"bottomColor"}].forEach(({object:o,key:i,params:n})=>{e.addBinding(o,i).on("change",({value:r})=>{this._options.skyEl.setAttribute("material",{...this._options.skyEl.getAttribute("material"),[i]:r})})})}}_highlightArea(t,{opacity:e=.2,duration:o=1}={}){this._tweens[t.name]?.kill(),this._tweens[t.name]=gsap.to(t.material,{opacity:e,duration:o})}_addListeners(){this._options.pinEls.forEach(t=>{t.addEventListener("click",e=>{this._options.cameraEl.setAttribute("move-to-target",{targetId:e.target.dataset.anchorId,initialPosition:{x:this._defaultCameraPosition.x,y:this._defaultCameraPosition.y,z:this._defaultCameraPosition.z},debug:this._options.debug});const o=this._areas.find(({name:i})=>i===e.target.dataset.area);o&&this._highlightArea(o)})})}_onDebugLoaded(){this._setCameraFolder(),this._setMapFolder(),this._setPinAnchorsFolder(),this._setHemisphereLightFolder(),this._setDirectionalLightFolder(),this._setSkyFolder()}_onSceneLoaded(){this._defaultCameraPosition.copy(this._options.cameraEl.getObject3D("camera").position),this._options.directionalLightEl.getObject3D("light").shadow.normalBias=.034,this._rotateCameraToDefault(),this._addListeners()}_onMapModelLoaded(){const t=this._options.mapEl.getObject3D("mesh");this._options.areaLabels.forEach(e=>{const o=t.getObjectByName(e);o&&(this._areas.push(o),this._highlightArea(o,{opacity:0,duration:0}))})}_init(){this._options.debug&&f.loadTweakpane().then(t=>{this._debugPanel=new t({title:"Settings",expanded:!1}),this._options.sceneEl.hasLoaded?this._onDebugLoaded():this._options.sceneEl.addEventListener("loaded",()=>{this._onDebugLoaded()})}),this._options.sceneEl.hasLoaded?this._onSceneLoaded():this._options.sceneEl.addEventListener("loaded",this._onSceneLoaded),this._options.mapEl.getObject3D("mesh")?this._onMapModelLoaded():this._options.mapEl.addEventListener("model-loaded",this._onMapModelLoaded)}moveCameraToDefault(){this._options.cameraEl.removeAttribute("move-to-target"),this._areas.forEach(t=>this._highlightArea(t,{opacity:0}))}}const L=new f({areaLabels:["north_course","south_course"],debug:window.location.hash==="#debug"}),w=document.getElementById("reset-camera-button");w.addEventListener("click",()=>{L.moveCameraToDefault()});
