(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))i(e);new MutationObserver(e=>{for(const n of e)if(n.type==="childList")for(const a of n.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&i(a)}).observe(document,{childList:!0,subtree:!0});function o(e){const n={};return e.integrity&&(n.integrity=e.integrity),e.referrerPolicy&&(n.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?n.credentials="include":e.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function i(e){if(e.ep)return;e.ep=!0;const n=o(e);fetch(e.href,n)}})();AFRAME.registerShader("gradientshader",{schema:{topColor:{type:"color",default:"1 0 0",is:"uniform"},bottomColor:{type:"color",default:"0 0 1",is:"uniform"}},vertexShader:["varying vec3 vWorldPosition;","void main() {"," vec4 worldPosition = modelMatrix * vec4( position, 1.0 );"," vWorldPosition = worldPosition.xyz;"," gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0 );","}"].join(`
`),fragmentShader:["#include <common>","#include <dithering_pars_fragment>","uniform vec3 bottomColor;","uniform vec3 topColor;","uniform float offset;","varying vec3 vWorldPosition;","void main() {"," float h = normalize( vWorldPosition ).y;"," gl_FragColor = vec4( mix( bottomColor, topColor, max( pow( max(h, 0.0 ), 0.8 ), 0.0 ) ), 1.0 );"," #include <dithering_fragment>","}"].join(`
`)});AFRAME.registerComponent("move-pin",{schema:{targetId:{default:""}},init(){const{targetId:s}=this.data;if(this.targetEl=document.getElementById(s),!this.targetEl)throw new Error(`[move-pin] Couldn't find el with id '${s}'`);this.canvasEl=this.el.sceneEl.renderer.domElement,this.camera=this.el.sceneEl.camera,this.worldPosition=new THREE.Vector3},tick(){this.el.object3D.getWorldPosition(this.worldPosition);const s=this.worldPosition.clone().project(this.camera),t=(s.x+1)/2*this.canvasEl.clientWidth,o=(-s.y+1)/2*this.canvasEl.clientHeight;this.targetEl.style.transform=`translate(${t}px, ${o}px)`}});AFRAME.registerComponent("move-to-target",{schema:{targetId:{default:""},debug:{default:!1},target:{default:{x:0,y:0,z:0}},initialPosition:{default:{x:0,y:0,z:0}}},init(){const{targetId:s}=this.data;if(this.targetEl=document.getElementById(s),!this.targetEl)throw new Error(`[move-to-target] Couldn't find el with id '${s}'`);this.scene=this.el.sceneEl.object3D,this.camera=this.el.getObject3D("camera"),this.targetPosition=new THREE.Vector3,this.targetEl.object3D.getWorldPosition(this.targetPosition);const t=this.buildCurve(this.el.getAttribute("position"),this.targetPosition,1,3);this.moveCamera({path:t,target:this.targetPosition})},remove(){this.moveCameraToDefault()},buildCurve(s,t,o=0,i=0){const{debug:e}=this.data,n=new THREE.Vector3(s.x,s.y,s.z),a=this.getControlPoint(s,t,.5),r=new THREE.Vector3(t.x,t.y+o,t.z),c=new THREE.Vector2(s.x-r.x,s.z-r.z);c.divideScalar(c.length()),r.set(r.x+c.x*i,r.y,r.z+c.y*i);const u=new THREE.QuadraticBezierCurve3(n,a,r);if(e){const l=u.getPoints(30),d=new THREE.BufferGeometry().setFromPoints(l),h=new THREE.Line(d,new THREE.LineBasicMaterial({color:16711680,transparent:!0,opacity:1}));h.name="debug_line",this.scene.add(h)}return u},moveCamera({path:s,target:t,onComplete:o}){const i=this,e=s.getLength(),n={value:0},a=new THREE.Quaternion().copy(i.camera.quaternion),r=s.getPointAt(1),c=new THREE.Matrix4;c.lookAt(r,t,new THREE.Vector3(0,1,0));const u=new THREE.Quaternion().setFromRotationMatrix(c);this.tween&&this.tween.kill(),this.tween=gsap.to(n,{duration:e/4,value:1,ease:Power1.easeInOut,onUpdate:function(l){const d=s.getPointAt(n.value);i.el.object3D.position.copy(d),l.lookAt(t);const h=new THREE.Quaternion().copy(l.quaternion),E=new THREE.Quaternion().copy(u);E.slerp(h,n.value*n.value*n.value),l.quaternion.slerpQuaternions(a,E,n.value)},onUpdateParams:[i.camera],onComplete:o})},moveCameraToDefault(){const{target:s,initialPosition:t}=this.data,o=this.buildCurve(this.el.getAttribute("position"),t);this.moveCamera({path:o,target:new THREE.Vector3(s.x,s.y,s.z),onComplete:()=>{}})},shortestAngle(s,t){return Math.atan2(Math.sin(t-s),Math.cos(t-s))},getControlPoint(s,t,o){const i=new THREE.Spherical().setFromVector3(s),e=new THREE.Spherical().setFromVector3(t),n=(i.radius+e.radius)/2,a=i.phi+this.shortestAngle(e.phi,i.phi)/2,r=(i.theta+e.theta)/2,c=new THREE.Spherical(n,a,r);return c.radius*=o,new THREE.Vector3().setFromSpherical(c)}});const b="modulepreload",v=function(s,t){return new URL(s,t).href},_={},y=function(t,o,i){let e=Promise.resolve();if(o&&o.length>0){let u=function(l){return Promise.all(l.map(d=>Promise.resolve(d).then(h=>({status:"fulfilled",value:h}),h=>({status:"rejected",reason:h}))))};const a=document.getElementsByTagName("link"),r=document.querySelector("meta[property=csp-nonce]"),c=r?.nonce||r?.getAttribute("nonce");e=u(o.map(l=>{if(l=v(l,i),l in _)return;_[l]=!0;const d=l.endsWith(".css"),h=d?'[rel="stylesheet"]':"";if(!!i)for(let m=a.length-1;m>=0;m--){const g=a[m];if(g.href===l&&(!d||g.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${l}"]${h}`))return;const p=document.createElement("link");if(p.rel=d?"stylesheet":b,d||(p.as="script"),p.crossOrigin="",p.href=l,c&&p.setAttribute("nonce",c),document.head.appendChild(p),d)return new Promise((m,g)=>{p.addEventListener("load",m),p.addEventListener("error",()=>g(new Error(`Unable to preload CSS for ${l}`)))})}))}function n(a){const r=new Event("vite:preloadError",{cancelable:!0});if(r.payload=a,window.dispatchEvent(r),!r.defaultPrevented)throw a}return e.then(a=>{for(const r of a||[])r.status==="rejected"&&n(r.reason);return t().catch(n)})};class f{static async loadTweakpane(){const{Pane:t}=await y(async()=>{const{Pane:o}=await import("https://unpkg.com/tweakpane@4.0.5/dist/tweakpane.min.js");return{Pane:o}},[],import.meta.url);return t}static waitForComponentInit(t,o,i){t&&(t.components[o]?i():t.addEventListener("componentinitialized",({detail:e})=>{e.name===o&&i()}))}_options={sceneEl:document.getElementById("scene"),cameraEl:document.getElementById("camera"),mapPivotEl:document.getElementById("map-pivot"),mapEl:document.getElementById("map"),pinAnchorEls:document.querySelectorAll("[id^=pin-anchor]"),pinEls:document.querySelectorAll("[id^=pin]"),hemisphereLightEl:document.getElementById("hemisphere-light"),directionalLightEl:document.getElementById("directional-light"),skyEl:document.getElementById("sky"),cameraLookAt:{x:0,y:0,z:0},debug:!1};_defaultCameraPosition=new THREE.Vector3;constructor(t={}){Object.assign(this._options,t),this._init()}_rotateCameraToDefault(){const t=this._options.cameraEl.getObject3D("camera");if(t){const o=this._options.cameraLookAt;t.lookAt(o.x,o.y,o.z)}}_setCameraFolder(){if(this._options.cameraEl){const t={position:this._options.cameraEl.getAttribute("position")},o=this._options.cameraEl.getAttribute("camera"),i=this._debugPanel.addFolder({title:"Camera",expanded:!1});i.addBinding(t,"position").on("change",({value:e})=>{this._options.cameraEl.setAttribute("position",e),this._rotateCameraToDefault()}),i.addBinding(this._options,"cameraLookAt").on("change",({value:e})=>{this._options.cameraLookAt=e,this._rotateCameraToDefault()}),i.addBinding(o,"fov").on("change",({value:e})=>{this._options.cameraEl.setAttribute("camera",{...this._options.cameraEl.getAttribute("camera"),fov:e})})}}_setMapFolder(){if(this._options.mapPivotEl&&this._options.mapEl){const t={position:this._options.mapEl.getAttribute("position"),scale:this._options.mapEl.getAttribute("scale")},o={rotation:this._options.mapPivotEl.getAttribute("rotation")},i=this._debugPanel.addFolder({title:"Map",expanded:!1});i.addBinding(o,"rotation").on("change",({value:e})=>{this._options.mapPivotEl.setAttribute("rotation",e)}),Object.keys(t).forEach(e=>{i.addBinding(t,e).on("change",({value:n})=>{this._options.mapEl.setAttribute(e,n)})})}}_setPinAnchorsFolder(){if(this._options.pinAnchorEls.length){const t={showPinAnchors:!1},o=this._debugPanel.addFolder({title:"Pin Anchors",expanded:!1});o.addBinding(t,"showPinAnchors").on("change",({value:i})=>{this._options.pinAnchorEls.forEach(e=>{e.setAttribute("visible",i)})}),this._options.pinAnchorEls.forEach(i=>{const e={position:i.getAttribute("position")};o.addBinding(e,"position",{step:.01}).on("change",({value:n})=>{i.setAttribute("position",n)})})}}_setHemisphereLightFolder(){if(this._options.hemisphereLightEl){const t={position:this._options.hemisphereLightEl.getAttribute("position")},o=this._options.hemisphereLightEl.getAttribute("light"),i=this._debugPanel.addFolder({title:"Hemisphere Light",expanded:!1});i.addBinding(t,"position",{step:.1}).on("change",({value:e})=>{this._options.hemisphereLightEl.setAttribute("position",e)}),[{object:o,key:"intensity",params:{step:.1}},{object:o,key:"color"}].forEach(({object:e,key:n,params:a})=>{i.addBinding(e,n,a).on("change",({value:r})=>{this._options.hemisphereLightEl.setAttribute("light",{...this._options.hemisphereLightEl.getAttribute("light"),[n]:r})})})}}_setDirectionalLightFolder(){if(this._options.directionalLightEl){const t={position:this._options.directionalLightEl.getAttribute("position")},o=this._options.directionalLightEl.getAttribute("light"),i=this._debugPanel.addFolder({title:"Directional Light",expanded:!1});i.addBinding(t,"position",{step:.1}).on("change",({value:e})=>{this._options.directionalLightEl.setAttribute("position",e)}),[{object:o,key:"intensity",params:{step:.1}},{object:o,key:"color"},{object:o,key:"castShadow"},{object:o,key:"shadowBias",params:{step:1e-5}},{object:o,key:"shadowRadius"}].forEach(({object:e,key:n,params:a})=>{i.addBinding(e,n,a).on("change",({value:r})=>{this._options.directionalLightEl.setAttribute("light",{...this._options.directionalLightEl.getAttribute("light"),[n]:r})})})}}_setSkyFolder(){if(this._options.skyEl){const t=this._options.skyEl.getAttribute("material"),o=this._debugPanel.addFolder({title:"Sky",expanded:!1});[{object:t,key:"topColor"},{object:t,key:"bottomColor"}].forEach(({object:i,key:e,params:n})=>{o.addBinding(i,e).on("change",({value:a})=>{this._options.skyEl.setAttribute("material",{...this._options.skyEl.getAttribute("material"),[e]:a})})})}}_addListeners(){this._options.pinEls.forEach(t=>{t.addEventListener("click",o=>{this._options.cameraEl.setAttribute("move-to-target",{targetId:o.target.dataset.anchorId,initialPosition:{x:this._defaultCameraPosition.x,y:this._defaultCameraPosition.y,z:this._defaultCameraPosition.z},debug:this._options.debug})})})}_onDebugLoaded(){this._setCameraFolder(),this._setMapFolder(),this._setPinAnchorsFolder(),this._setHemisphereLightFolder(),this._setDirectionalLightFolder(),this._setSkyFolder()}_onSceneLoaded(){this._defaultCameraPosition=this._options.cameraEl.getAttribute("position"),this._rotateCameraToDefault(),this._addListeners()}_init(){this._options.debug&&(this._options.cameraEl.setAttribute("look-controls",{enabled:!0}),f.loadTweakpane().then(t=>{this._debugPanel=new t({title:"Settings",expanded:!1}),this._options.sceneEl.hasLoaded?this._onDebugLoaded():this._options.sceneEl.addEventListener("loaded",()=>{this._onDebugLoaded()})})),this._options.sceneEl.hasLoaded?this._onSceneLoaded():this._options.sceneEl.addEventListener("loaded",()=>{this._onSceneLoaded()})}moveCameraToDefault(){this._options.cameraEl.removeAttribute("move-to-target")}}const A=new f({debug:window.location.hash==="#debug"}),w=document.getElementById("reset-camera-button");w.addEventListener("click",()=>{A.moveCameraToDefault()});
